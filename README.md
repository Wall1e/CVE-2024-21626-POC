# CVE-2024-21626-POC

# 使用说明
仅供教育/研究使用，任何与教育/研究无关的行为所产生的风险自行负责

# 使用
```bash
docker build . -t cve-2024-21626
docker run -it --rm cve-2024-21626 bash /poc.sh
# 另起一个terminal
/bin/bash.copy
```

# 注意
不同docker/runc版本使用的具体文件描述符有所不同，例如docker server:20.10.17 && runc version 1.1.2 的情况下使用 /proc/self/fd/9，实际的 fd 可能根据文件打开顺序而改变，官方文档中指出大多数情况下应该使用 /proc/self/fd/7
想要知道实际所使用的fd可以自行编译一个runc，在nsexec函数处sleep
```bash
#使用ps 找到对应runc init进程的pid
ps -ef | grep runc
# 查看指向/sys/fs/cgroup的fd
ls -lh/proc/{pid runc init}/fd
```

修改：在Dockerfile中修改WORKDIR为对应的值

# 前置条件
同时满足以下条件：
```
1. 可以创建容器并指定执行命令
2. 可以指定容器使用的镜像
```

# 漏洞原理
TODO


# 参考
https://github.com/opencontainers/runc/security/advisories/GHSA-xr7r-f8xq-vfvv

https://github.com/opencontainers/runc/commit/2a4ed3e75b9e80d93d1836a9c4c1ebfa2b78870e